<?php/** * Created by PhpStorm. * User: nicol * Date: 2019/09/21 * Time: 07:58 *//** Start php session */session_start();/** Include the products as specified by spec */require_once __DIR__ . '/products_include.php';/** Set website root */$websiteURLRoot = '/cart/';?><!DOCTYPE html><html lang="en">    <head>        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">        <meta charset="utf-8">        <title>Cart</title>        <!-- Meta Tags -->        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">        <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>        <link href="css/bootstrap.min.css" rel="stylesheet">        <link href="css/font-awesome.min.css" rel="stylesheet">        <link href="css/jquery-ui-1.8.16.custom.css" rel="stylesheet">        <link href="css/keyframes.css" rel="stylesheet">        <link href="css/main.css" rel="stylesheet">        <link href="css/custom.css" rel="stylesheet">        <script src="js/jquery.min.js"></script>        <script src="js/bootstrap.min.js"></script>        <script src="js/custom.js"></script>        <script stype="text/javascript">            var currency_prefix = "<?php echo SITE_CURRENCY_PREFIX; ?> ";        </script>    </head>    <body>        <div class="title-bar">            <!-- Top Title Bar -->            <div class="title-bar">                <div class="row">                    <div class="col-lg-6 main-title-left">                        Cart Application                    </div>                </div>            </div>        </div>        <div class="main-message-bar">            <!-- Top Title Bar -->            <div class="main-message-bar" id="main-message-bar">            </div>        </div>        <div class="wrapper" id="wrapper"> <!-- Start of page wrapper -->            <!-- Main Content Row -->            <div class="row">                <!-- Left Side (Product View) -->                <div class="col-xs-12 col-lg-6 main-content-body">                    <!-- Product Table -->                    <table class="table">                        <thead>                        <tr>                            <th>Product</th>                            <th>Price</th>                            <th>Action</th>                        </tr>                        </thead>                        <tbody>                        <?php foreach($products as $product){ ?>                            <tr>                                <td><?php echo $product['name']; ?></td>                                <td><?php echo SITE_CURRENCY_PREFIX .' '.number_format(round($product['price'], 2), 2); ?></td>                                <td><button class="btn btn-sm btn-primary" id='<?php echo $product['name']; ?>LoadingButton' onclick="addToCart('<?php echo $product['name'] ?>');"><i class="fa fa-plus"></i>&nbsp;&nbsp;Add to Cart</button></td>                            </tr>                        <?php } ?>                        </tbody>                    </table>                </div>                <!-- Right Side (Cart View) -->                <div class="col-xs-12 col-lg-4 col-lg-offset-2 main-cart-body">                    <!-- start of cart accordion -->                    <div class="panel-group side-cart" id="accordion">                        <div class="panel panel-default">                            <div>                                <h2>                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseCart" style="text-decoration: none;">                                        <i class="fa fa-shopping-cart"></i>&nbsp;&nbsp;View Cart                                    </a>                                </h2>                            </div>                            <div id="collapseCart" class="panel-collapse collapse">                                <div class="panel-body" style="font-size: xx-small" id="cart_content_div">                                    <?php if(isset($_SESSION['cart'])){ ?>                                        <table class="table" id="cart_table">                                            <thead>                                            <tr>                                                <th>Product</th>                                                <th>Price</th>                                                <th>Quantity</th>                                                <th>Total</th>                                                <th>Remove</th>                                            </tr>                                            </thead>                                            <tbody id="cart_body">                                                <?php foreach($_SESSION['cart'] as $cart_item){ ?>                                                    <tr>                                                        <td><?php echo $cart_item['name']; ?></td>                                                        <td><?php echo SITE_CURRENCY_PREFIX .' '. number_format($cart_item['price'], 2); ?></td>                                                        <td><?php echo $cart_item['quantity']; ?></td>                                                        <td><?php echo SITE_CURRENCY_PREFIX .' '. number_format(round($cart_item['price'], 2)* $cart_item['quantity'], 2); ?></td>                                                        <td class="removeButton" onclick="removeItem('<?php echo $cart_item["name"]; ?>');"><i class="fa fa-remove"></i></td>                                                    </tr>                                                <?php } ?>                                                <tr><td>Total: </td><td colspan="3" style="text-align:right;"><?php echo SITE_CURRENCY_PREFIX .' '. number_format($_SESSION['cart_total'], 2); ?></td><td></td></tr>                                            </tbody>                                        </table>                                        <br/><br/>                                        <button class="btn btn-small" onclick="clearCart();">Clear Cart</button>                                    <?php }else{ ?>                                        The cart is empty                                    <?php } ?>                                </div>                            </div>                        </div>                    </div>                    <!-- End of cart accordion -->                </div>            </div>        </div> <!-- End of page wrapper -->        <!-- Post page load javascript -->        <script type="text/javascript">            /** This function clears a modal message span             *             * @param string parent     The id of the element to clear from messages             * */            function clearMessages(parent){                $("#"+parent).html("");            }            /** This function converts a div into a loading div             *             * @param string parent         The id of the element to convert into a loading element             * */            function enableLoadingDiv(parent){                $("#"+parent).html("<div class='col-lg-12' style='text-align: center;'><i class='fa fa-cog fa-5x fa-spin text-info'></i></div>");            }            /** This function changes the innerHTML of a button to the loading text, it also disables the button             *             * @param string button         The id of the button to set to a loading button             * */            function setLoadingButton(button){                $("#"+button).prop("disabled", "disabled");                $("#"+button).html("<i class='fa fa-cog fa-spin'></i> Loading...");            }            /** This function changes the innerHTML of a button from a loading button to normal button, also enables the button             *             * @param string button         The id of the button to be edited             * @param string html           The html of the button to be changed to             * */            function changeBackLoadingButton(button, html){                $("#"+button).prop("disabled", "");                $("#"+button).html(html);            }            /** Display a message on a modal window             *             * @param string type       Type of message to display using theme helper class (success, info, danger, etc.)             * @param string parent     The id of the parent element in which to display the message             * @param string message    The html message to display in the message wrapper             * */            function displayMessage(parent, type, message){                /** Create message and append to parent */                var message = "<div class='row'><div class='col-lg-12'><div class='alert alert-"+ type +"'>"+ message +"</div></div></div>";                $("#"+parent).html(message);                /** Scroll to message */                $([document.documentElement, document.body]).animate({                    scrollTop: $("#"+parent).offset().top                }, 500);            }            /** This function adds an itme to the cart             *             * @param string item           The name of the item to be added             * */            function addToCart(item){                /** Clear messages */                clearMessages('main-message-bar');                /** Add and prepare post data */                var post_data = new Object();                post_data.action = 'addItem';                post_data.item = item;                /** Execute Ajax call to add item to cart */                $.ajax({                    url: "<?php echo $websiteURLRoot; ?>ajax/editCart.php",                    type: "POST",                    data: post_data,                    dataType: "json",                    beforeSend: function (data) {                        /** Set loading button and disable while operation is busy */                        setLoadingButton(item+"LoadingButton");                    },                    success: function(data){                        /** Handle if success, else display error message */                        if(data.message_type == "success"){                            if(data.payload.cart && data.payload.cart.length > 0){                                /** Update the cart div with new values */                                $("#cart_content_div").html("<table class='table' id='cart_table'>" +                                    "<thead>" +                                        "<tr>" +                                            "<th>Product</th>" +                                            "<th>Price</th>" +                                            "<th>Quantity</th>" +                                            "<th>Total</th>" +                                            "<th>Remove</th>" +                                        "</tr>" +                                    "</thead>" +                                    "<tbody id='cart_body'></tbody>" +                                "</table>");                                /** Loop through items and add to cart display */                                for(var x = 0; x < data.payload.cart.length; x++){                                    /** Add items to table body */                                    $("#cart_body").append("" +                                        "<tr>" +                                            "<td>"+ data.payload.cart[x].name +"</td>" +                                            "<td>"+ currency_prefix +" "+data.payload.cart[x].price.toFixed(2) +"</td>" +                                            "<td>"+ data.payload.cart[x].quantity +"</td>" +                                            "<td>"+ currency_prefix +" "+(data.payload.cart[x].price * data.payload.cart[x].quantity).toFixed(2) +"</td>" +                                            "<td class='removeButton' onclick='removeItem(\""+ data.payload.cart[x].name +"\");'><i class='fa fa-remove'></i></td>"+                                        "</tr>");                                }                                /** Append Total Row */                                $("#cart_body").append("<tr><td>Total: </td><td colspan='3' style='text-align:right;'>"+ currency_prefix +" "+data.payload.total.toFixed(2) +"</td><td></td></tr>");                                /** Append clear cart button */                                $("#cart_content_div").append("<br/><br/><button class='btn btn-small' onclick='clearCart();'>Clear Cart</button>");                            }else{                                /** Display empty cart message */                                $("#cart_table").remove();                                $("#cart_content_div").html("The cart is empty");                            }                        }else{                            /** Display Message if not success */                            displayMessage('main-message-bar', data.message_type, data.message_content);                        }                    },                    error: function(data){                        /** Handle Return Data */                        var return_data = null;                        if(data.responseText){                            return_data = JSON.parse(data.responseText);                            displayMessage("main-message-bar", return_data.message_type, return_data.message_content);                        }else{                            displayMessage("main-message-bar", 'danger', 'Unknown error occurred. See log for details.');                        }                    },                    complete: function(data){                        /** Change back loading button text and enable button again */                        changeBackLoadingButton(item+"LoadingButton", "<i class='fa fa-plus'></i>&nbsp;&nbsp;Add to Cart");                    }                });            }            /** This function removes 1qty of the selected item from the cart             *             * @param string item           The name of the item to be decreased             * */            function removeItem(item){                /** Clear messages */                clearMessages('main-message-bar');                /** Add and prepare post data */                var post_data = new Object();                post_data.action = 'removeItem';                post_data.item = item;                /** Execute Ajax call to remove item from cart */                $.ajax({                    url: "<?php echo $websiteURLRoot; ?>ajax/editCart.php",                    type: "POST",                    data: post_data,                    dataType: "json",                    success: function(data){                        /** Handle if success, else display error message */                        if(data.message_type == "success"){                            if(data.payload.cart && data.payload.cart.length > 0){                                /** Update the cart div with new values */                                $("#cart_content_div").html("<table class='table' id='cart_table'>" +                                    "<thead>" +                                        "<tr>" +                                            "<th>Product</th>" +                                            "<th>Price</th>" +                                            "<th>Quantity</th>" +                                            "<th>Total</th>" +                                            "<th>Remove</th>" +                                        "</tr>" +                                    "</thead>" +                                    "<tbody id='cart_body'></tbody>" +                                "</table>");                                /** Loop through items and add to cart display */                                for(var x = 0; x < data.payload.cart.length; x++){                                    /** Add items to table body */                                    $("#cart_body").append("" +                                        "<tr>" +                                            "<td>"+ data.payload.cart[x].name +"</td>" +                                            "<td>"+ currency_prefix +" "+data.payload.cart[x].price.toFixed(2) +"</td>" +                                            "<td>"+ data.payload.cart[x].quantity +"</td>" +                                            "<td>"+ currency_prefix +" "+(data.payload.cart[x].price * data.payload.cart[x].quantity).toFixed(2) +"</td>" +                                            "<td class='removeButton' onclick='removeItem(\""+ data.payload.cart[x].name +"\");'><i class='fa fa-remove'></i></td>"+                                        "</tr>");                                }                                /** Append Total Row */                                $("#cart_body").append("<tr><td>Total: </td><td colspan='3' style='text-align:right;'>"+ currency_prefix +" "+data.payload.total.toFixed(2) +"</td><td></td></tr>");                                /** Append clear cart button */                                $("#cart_content_div").append("<br/><br/><button class='btn btn-small' onclick='clearCart();'>Clear Cart</button>");                            }else{                                /** Display empty cart message */                                $("#cart_table").remove();                                $("#cart_content_div").html("The cart is empty");                            }                        }else{                            /** Display message if not success */                            displayMessage('main-message-bar', data.message_type, data.message_content);                        }                    },                    error: function(data){                        /** Handle Return Data */                        var return_data = null;                        if(data.responseText){                            return_data = JSON.parse(data.responseText);                            displayMessage("main-message-bar", return_data.message_type, return_data.message_content);                        }else{                            displayMessage("main-message-bar", 'danger', 'Unknown error occurred. See log for details.');                        }                    }                });            }            /** This function clears all items from cart */            function clearCart(){                /** Clear messages */                clearMessages('main-message-bar');                /** Add and prepare post data */                var post_data = new Object();                post_data.action = 'clearCart';                /** Execute Ajax call to add item to cart */                $.ajax({                    url: "<?php echo $websiteURLRoot; ?>ajax/editCart.php",                    type: "POST",                    data: post_data,                    dataType: "json",                    success: function(data){                        /** Handle if success, else display error message */                        if(data.message_type == "success"){                            /** Update the cart div with new values */                            if(!data.payload){                                /** Remove the cart table */                                $("#cart_table").remove();                                $("#cart_content_div").html("The cart is empty");                            }                        }else{                            /** Display error message */                            displayMessage('main-message-bar', data.message_type, data.message_content);                        }                    },                    error: function(data){                        /** Handle Return Data */                        var return_data = null;                        if(data.responseText){                            return_data = JSON.parse(data.responseText);                            displayMessage("main-message-bar", return_data.message_type, return_data.message_content);                        }else{                            displayMessage("main-message-bar", 'danger', 'Unknown error occurred. See log for details.');                        }                    }                });            }        </script>    </body></html>